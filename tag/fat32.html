<!DOCTYPE html>
<html lang="en">
<head>
        <title>notes to self - fat32</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="http://kerma.github.io/theme/css/main.css" type="text/css" />
        <link href="http://kerma.github.io/" type="application/atom+xml" rel="alternate" title="notes to self ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="http://kerma.github.io/css/ie.css"/>
                <script src="http://kerma.github.io/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="http://kerma.github.io/css/ie6.css"/><![endif]-->

</head>

<body>
        
        

            <header>
                <h1><a href="http://kerma.github.io" id="site-title">notes to self </a> : <a href="http://kerma.github.io/resize-fat-partition.html" id="page-title">How to resize FAT partition in Linux without losing data</a></h1>
<time datetime="2013-03-12T00:00:00">Tue 12 March 2013</time>            </header>

            <article>
                <p>I have a small external hard drive that had three partitions on it. One I
created for TimeMachine backups, one for keeping movies and one that I was not
aware of. It had a boot flag so I suspect it was created by TimeMachine itself.</p>
<p>So once I got a bigger HD just for TimeMachine I no longer needed the allocated
100GB on that older drive. Getting rid of it however without losing data seemed
a bit too complicated in Mac OS X. I was also too lazy to back up my data so I
could just reformat the whole drive with Disk Utility.</p>
<p>Couple of days ago I finally set up my headless home media server running Ubuntu
12.04 LTS (more on this later) and I thought it's a good time to revisit the
partitioning problem. </p>
<p><a href="http://gparted.sourceforge.net/">GParted</a> was the first obvious thing, except I had no X11 installed. GParted has
a command line interface as well, but installing all those gtk lib dependencies just for that didn't
seem reasonable.</p>
<p>A lot of searches later I wasn't still much smarter. There are many ways how to
accomplish the task, but none of them actually said that you might not even
experience any data loss.</p>
<p>So I had to pull myself together and start with the backup. After that I decided
to try my luck with <a href="http://www.gnu.org/software/parted/">Parted</a>. It came with
the server and should work on pretty much on all Linux distros. I have version
2.3 and I think it's the latest that works, because in the Parted user manual
they say: "Note that after version 2.4, the following commands were removed:
check, cp, mkfs, mkpartfs, move, resize."</p>
<p>So this was my 'fdisk -l' output:</p>
<div class="highlight"><pre>    <span class="n">Disk</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb</span><span class="o">:</span> <span class="mf">250.1</span> <span class="n">GB</span><span class="p">,</span> <span class="mi">250059350016</span> <span class="n">bytes</span>
    <span class="mi">255</span> <span class="n">heads</span><span class="p">,</span> <span class="mi">63</span> <span class="n">sectors</span><span class="o">/</span><span class="n">track</span><span class="p">,</span> <span class="mi">30401</span> <span class="n">cylinders</span><span class="p">,</span> <span class="n">total</span> <span class="mi">488397168</span> <span class="n">sectors</span>
    <span class="n">Units</span> <span class="o">=</span> <span class="n">sectors</span> <span class="n">of</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">512</span> <span class="o">=</span> <span class="mi">512</span> <span class="n">bytes</span>
    <span class="n">Sector</span> <span class="n">size</span> <span class="p">(</span><span class="n">logical</span><span class="o">/</span><span class="n">physical</span><span class="p">)</span><span class="o">:</span> <span class="mi">512</span> <span class="n">bytes</span> <span class="o">/</span> <span class="mi">512</span> <span class="n">bytes</span>
    <span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="n">size</span> <span class="p">(</span><span class="n">minimum</span><span class="o">/</span><span class="n">optimal</span><span class="p">)</span><span class="o">:</span> <span class="mi">512</span> <span class="n">bytes</span> <span class="o">/</span> <span class="mi">512</span> <span class="n">bytes</span>
    <span class="n">Disk</span> <span class="n">identifier</span><span class="o">:</span> <span class="mh">0x8d7fe87c</span>

    <span class="n">Device</span> <span class="n">Boot</span>      <span class="n">Start</span>         <span class="n">End</span>      <span class="n">Blocks</span>   <span class="n">Id</span>  <span class="n">System</span>
    <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb1</span>               <span class="mi">1</span>      <span class="mi">409639</span>      <span class="mi">204819</span><span class="o">+</span>  <span class="n">ee</span>  <span class="n">GPT</span>
    <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb2</span>          <span class="mi">409640</span>   <span class="mi">195722143</span>    <span class="mi">97656252</span>   <span class="n">af</span>  <span class="n">HFS</span> <span class="o">/</span> <span class="n">HFS</span><span class="o">+</span>
    <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb3</span>       <span class="mi">195984288</span>   <span class="mi">488134983</span>   <span class="mi">146075348</span>    <span class="n">b</span>  <span class="n">W95</span> <span class="n">FAT32</span>
</pre></div>


<p>I needed to preserve /dev/sdb3, have all my files still accessible and extend
the size of the partition form 150GB to the whole disk 250GB.</p>
<p>I started with unmounting everything (every command below was performed as a
root):</p>
<div class="highlight"><pre>    <span class="n">umount</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb1</span>
    <span class="n">umount</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb2</span>
    <span class="n">umount</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb3</span>
</pre></div>


<p>Then I started Parted with 'parted /dev/sdb'. After typing 'print' I saw:</p>
<div class="highlight"><pre>    <span class="nl">Model:</span> <span class="n">WDC</span> <span class="n">WD25</span> <span class="mo">00</span><span class="n">BEVT</span><span class="o">-</span><span class="mo">00</span><span class="n">SCST0</span> <span class="p">(</span><span class="n">scsi</span><span class="p">)</span>
    <span class="n">Disk</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb</span><span class="o">:</span> <span class="mi">250</span><span class="n">GB</span>
    <span class="n">Sector</span> <span class="n">size</span> <span class="p">(</span><span class="n">logical</span><span class="o">/</span><span class="n">physical</span><span class="p">)</span><span class="o">:</span> <span class="mi">512</span><span class="n">B</span><span class="o">/</span><span class="mi">512</span><span class="n">B</span>
    <span class="n">Partition</span> <span class="n">Table</span><span class="o">:</span> <span class="n">gpt</span>

    <span class="n">Number</span>  <span class="n">Start</span>   <span class="n">End</span>    <span class="n">Size</span>   <span class="n">File</span> <span class="n">system</span>  <span class="n">Name</span>                   <span class="n">Flags</span>
    <span class="mi">1</span>      <span class="mf">20.5</span><span class="n">kB</span>  <span class="mi">210</span><span class="n">MB</span>  <span class="mi">210</span><span class="n">MB</span>  <span class="n">fat32</span>        <span class="n">EFI</span> <span class="n">System</span> <span class="n">Partition</span>   <span class="n">boot</span>
    <span class="mi">2</span>      <span class="mi">210</span><span class="n">MB</span>   <span class="mi">100</span><span class="n">GB</span>  <span class="mi">100</span><span class="n">GB</span>  <span class="n">hfs</span><span class="o">+</span>         <span class="n">MacBook</span>
    <span class="mi">3</span>      <span class="mi">100</span><span class="n">GB</span>   <span class="mi">250</span><span class="n">GB</span>  <span class="mi">150</span><span class="n">GB</span>  <span class="n">fat32</span>        <span class="n">DOS_FAT_32_Untitled_2</span>
</pre></div>


<p>Ok, let's remove unnecessary partitions:</p>
<div class="highlight"><pre>    <span class="p">(</span><span class="n">parted</span><span class="p">)</span> <span class="n">rm</span> <span class="mi">1</span>
    <span class="p">(</span><span class="n">parted</span><span class="p">)</span> <span class="n">rm</span> <span class="mi">2</span>
    <span class="p">(</span><span class="n">parted</span><span class="p">)</span> <span class="n">print</span>
    <span class="nl">Model:</span> <span class="n">WDC</span> <span class="n">WD25</span> <span class="mo">00</span><span class="n">BEVT</span><span class="o">-</span><span class="mo">00</span><span class="n">SCST0</span> <span class="p">(</span><span class="n">scsi</span><span class="p">)</span>
    <span class="n">Disk</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb</span><span class="o">:</span> <span class="mi">250</span><span class="n">GB</span>
    <span class="n">Sector</span> <span class="n">size</span> <span class="p">(</span><span class="n">logical</span><span class="o">/</span><span class="n">physical</span><span class="p">)</span><span class="o">:</span> <span class="mi">512</span><span class="n">B</span><span class="o">/</span><span class="mi">512</span><span class="n">B</span>
    <span class="n">Partition</span> <span class="n">Table</span><span class="o">:</span> <span class="n">gpt</span>

    <span class="n">Number</span>  <span class="n">Start</span>  <span class="n">End</span>    <span class="n">Size</span>   <span class="n">File</span> <span class="n">system</span>  <span class="n">Name</span>                   <span class="n">Flags</span>
    <span class="mi">3</span>      <span class="mi">100</span><span class="n">GB</span>  <span class="mi">250</span><span class="n">GB</span>  <span class="mi">150</span><span class="n">GB</span>  <span class="n">fat32</span>        <span class="n">DOS_FAT_32_Untitled_2</span>
</pre></div>


<p>That was easy. Now I just closed my eyes, prayed and typed:</p>
<div class="highlight"><pre>    <span class="p">(</span><span class="n">parted</span><span class="p">)</span> <span class="n">resize</span> <span class="mi">3</span>
    <span class="nl">WARNING:</span> <span class="n">you</span> <span class="n">are</span> <span class="n">attempting</span> <span class="n">to</span> <span class="n">use</span> <span class="n">parted</span> <span class="n">to</span> <span class="n">operate</span> <span class="n">on</span> <span class="p">(</span><span class="n">resize</span><span class="p">)</span> <span class="n">a</span> <span class="n">file</span> <span class="n">system</span><span class="p">.</span>
    <span class="n">parted</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">file</span> <span class="n">system</span> <span class="n">manipulation</span> <span class="n">code</span> <span class="n">is</span> <span class="n">not</span> <span class="n">as</span> <span class="n">robust</span> <span class="n">as</span> <span class="n">what</span> <span class="n">you</span><span class="err">&#39;</span><span class="n">ll</span> <span class="n">find</span> <span class="n">in</span>
    <span class="n">dedicated</span><span class="p">,</span> <span class="n">file</span><span class="o">-</span><span class="n">system</span><span class="o">-</span><span class="n">specific</span> <span class="n">packages</span> <span class="n">like</span> <span class="n">e2fsprogs</span><span class="p">.</span>  <span class="n">We</span> <span class="n">recommend</span>
    <span class="n">you</span> <span class="n">use</span> <span class="n">parted</span> <span class="n">only</span> <span class="n">to</span> <span class="n">manipulate</span> <span class="n">partition</span> <span class="n">tables</span><span class="p">,</span> <span class="n">whenever</span> <span class="n">possible</span><span class="p">.</span>
    <span class="n">Support</span> <span class="k">for</span> <span class="n">performing</span> <span class="n">most</span> <span class="n">operations</span> <span class="n">on</span> <span class="n">most</span> <span class="n">types</span> <span class="n">of</span> <span class="n">file</span> <span class="n">systems</span>
    <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="n">in</span> <span class="n">an</span> <span class="n">upcoming</span> <span class="n">release</span><span class="p">.</span>
    <span class="n">Start</span><span class="o">?</span>  <span class="p">[</span><span class="mi">100</span><span class="n">GB</span><span class="p">]</span><span class="o">?</span> <span class="mi">0</span><span class="n">GB</span>
    <span class="n">End</span><span class="o">?</span>  <span class="p">[</span><span class="mi">250</span><span class="n">GB</span><span class="p">]</span><span class="o">?</span>

    <span class="p">(</span><span class="n">parted</span><span class="p">)</span> <span class="n">print</span>
    <span class="nl">Model:</span> <span class="n">WDC</span> <span class="n">WD25</span> <span class="mo">00</span><span class="n">BEVT</span><span class="o">-</span><span class="mo">00</span><span class="n">SCST0</span> <span class="p">(</span><span class="n">scsi</span><span class="p">)</span>
    <span class="n">Disk</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb</span><span class="o">:</span> <span class="mi">250</span><span class="n">GB</span>
    <span class="n">Sector</span> <span class="n">size</span> <span class="p">(</span><span class="n">logical</span><span class="o">/</span><span class="n">physical</span><span class="p">)</span><span class="o">:</span> <span class="mi">512</span><span class="n">B</span><span class="o">/</span><span class="mi">512</span><span class="n">B</span>
    <span class="n">Partition</span> <span class="n">Table</span><span class="o">:</span> <span class="n">gpt</span>

    <span class="n">Number</span>  <span class="n">Start</span>   <span class="n">End</span>    <span class="n">Size</span>   <span class="n">File</span> <span class="n">system</span>  <span class="n">Name</span>                   <span class="n">Flags</span>
    <span class="mi">3</span>      <span class="mf">17.4</span><span class="n">kB</span>  <span class="mi">250</span><span class="n">GB</span>  <span class="mi">250</span><span class="n">GB</span>  <span class="n">fat32</span>        <span class="n">DOS_FAT_32_Untitled_2</span>

    <span class="p">(</span><span class="n">parted</span><span class="p">)</span> <span class="n">quit</span>
</pre></div>


<p>Resize worked nicely. I mounted the drive and were much pleased. All my data
still there and accessible. I hope you will be as fortunate as me (: </p>            </article>

        <footer>
            <nav>
                <ul>
                    <li><a href="http://kerma.github.io/pages/about.html">About</a></li>
                    <li>:: <a href="http://kerma.github.io/tags.html">Tags</a></li>
                </ul>
            </nav>
                <p id="theme-credit"><a href="http://mathieu.agopian.info/mnmlist/theme.html">Thème mnmlist</a></p>
        </footer>

</body>
</html>